<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Emacs Trick</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Emacs Trick"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-10-27 05:12:21 CST"/>
<meta name="author" content="visaya fan"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>

<script type="text/javascript" src="../../Layout/JS/org-info.js"></script>
<script type="text/javascript" >
<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "#cccccc");
org_html_manager.set("FIXED_TOC", "1");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "overview");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>

<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>


<div id="content">
<h1 class="title">Emacs Trick</h1>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"> </script>
<link rel="stylesheet" type="text/css" href="../../Layout/CSS/vf.css" />
<script src="../../Layout/JS/bootstrap_old.js"></script>



<div id="table-of-contents">
<h2>TOC</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 用grep在文件中查找</a>
<ul>
<li><a href="#sec-1-1">1.1 lgrep</a></li>
<li><a href="#sec-1-2">1.2 grep</a></li>
</ul>
</li>
<li><a href="#sec-2">2 执行shell命令</a></li>
<li><a href="#sec-3">3 multiple-cursors</a></li>
<li><a href="#sec-4">4 align-regexp</a></li>
<li><a href="#sec-5">5 list-matching-lines</a></li>
<li><a href="#sec-6">6 occur/re-builder/multi-occur/multi-occur-in-matching-buffers</a></li>
<li><a href="#sec-7">7 apropos</a></li>
<li><a href="#sec-8">8 follow-mode</a></li>
<li><a href="#sec-9">9 hexl-mode</a></li>
<li><a href="#sec-10">10 backup-by-copying-when-linked</a></li>
<li><a href="#sec-11">11 zap-to-char</a></li>
<li><a href="#sec-12">12 fill-paragraph</a></li>
<li><a href="#sec-13">13 <i>sudo::</i></a></li>
<li><a href="#sec-14">14 正则表达式</a></li>
<li><a href="#sec-15">15 eshell 别名/使用.bashrc中定义的别名</a></li>
<li><a href="#sec-16">16 解决org-mode example/src/quote上面多一行问题</a></li>
<li><a href="#sec-17">17 分享/评论</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 用grep在文件中查找</h2>
<div class="outline-text-2" id="text-1">

<p>  可以直接在grep buffer中修改文件。<br/>
</p>
</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> lgrep</h3>
<div class="outline-text-3" id="text-1-1">

<blockquote>

<p>(lgrep REGEXP &amp;optional FILES DIR CONFIRM)<br/>
</p>
</blockquote>


<p>
   查找指定目录DIR下指定模式文件FILES内容中符合REGEXP的文件，GREP buffer中n/p上下选择。<br/>
</p></div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> grep</h3>
<div class="outline-text-3" id="text-1-2">

<p>   指定文件中查找<br/>
</p><blockquote>

<p>grep -nH -e "pattern" filename<br/>
</p>
</blockquote>


<p>
   其中H表输出中包含文件名，n表输出中包含行号，e表紧跟模式<br/>
</p></div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 执行shell命令</h2>
<div class="outline-text-2" id="text-2">

<p>  M-! 执行shell命令<br/>
  加前缀C-u执行命令的结果作用在buffer上。<br/>
  类似C-u M-|结果作用在region上<br/>
</p></div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> multiple-cursors</h2>
<div class="outline-text-2" id="text-3">

<blockquote>

<p>(global-set-key (kbd "C-S-c C-S-c") 'mc/edit-lines)<br/>
(global-set-key (kbd "C-S-c C-e") 'mc/edit-ends-of-lines)<br/>
(global-set-key (kbd "C-S-c C-a") 'mc/edit-beginnings-of-lines)<br/>
(global-set-key (kbd "C-&gt;") 'mc/mark-next-like-this)<br/>
(global-set-key (kbd "C-&lt;") 'mc/mark-previous-like-this)<br/>
(global-set-key (kbd "C-S-c C-&lt;") 'mc/mark-all-like-this)<br/>
(global-set-key (kbd "C-S-c C-&gt;") 'mc/mark-all-in-region)<br/>
</p>
</blockquote>


<p>
  先选中一个region，mc/edit-lines则对该region每行都有一个光标。mc/mark-next-like-this在与region内容相同的下一处加一光标。其它函数同理。<br/>
</p></div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> align-regexp</h2>
<div class="outline-text-2" id="text-4">

<p>  满足指定正则表达式的对齐，有时对整理注释比较有用。<br/>
  其它用法：<a href="http://emacswiki.org/emacs/AlignCommands">EmacsWiki</a><br/>
</p></div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> list-matching-lines</h2>
<div class="outline-text-2" id="text-5">

<p>  列出当前buffer中所有满足指定正则表达式的行<br/>
</p></div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> occur/re-builder/multi-occur/multi-occur-in-matching-buffers</h2>
<div class="outline-text-2" id="text-6">

<p>  在进行正则替换行为确保万无一失，先检查一下，occur后输入regexp则会显示所有匹配内容。<br/>
  与occur另开一buffer显示匹配不同，re-builder实行动态匹配，即一边在RE-Builder中输入regexp一边匹配（此功能很不错）。<br/>
  前面两个都是在当前buffer中匹配，而multi-occur/multi-occur-in-matching-buffers是在多个buffer中匹配<br/>
</p></div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> apropos</h2>
<div class="outline-text-2" id="text-7">

<p>  输入一个regexp，Emacs根据你所输入的regexp和当前buffer的内容构造出更多的regexp，也许Emacs构造的比你的更合适的。<br/>
</p></div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> follow-mode</h2>
<div class="outline-text-2" id="text-8">

<p>  启用该模式后，C-x 3分屏后，一个文件左右连接显示，适合阅读。<br/>
</p></div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> hexl-mode</h2>
<div class="outline-text-2" id="text-9">

<p>  编辑非文本文件。<br/>
</p></div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> backup-by-copying-when-linked</h2>
<div class="outline-text-2" id="text-10">

<p>  当文件存在硬链接时默认的备份会破坏这种链接（新建一个文件在新文件中修改，与原来链接文件的inode不同，故与原来链接文件存在链接关系的文件不会同步更新），可以修改当存在链接的时候,通过拷贝来备份，而不是写进一个新文件，故链接关系不会被破坏。<br/>
</p><blockquote>

<p>(setq backup-by-copying-when-linked t)<br/>
</p>
</blockquote>


<p>
  如果你在使用dropbox这种方法就非常有用，把想要保存在dropbox中的文件硬链接到dropbox目录下，既不占空间又能保持同步更新。<br/>
</p>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> zap-to-char</h2>
<div class="outline-text-2" id="text-11">

<p>  默认绑定到M-z，删除当前位置到下一个输入字符之间的字符，有时候会很有用。<br/>
</p></div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> fill-paragraph</h2>
<div class="outline-text-2" id="text-12">

<p>  默认绑定到M-q，调整region,不满一行的由下一行补齐,默认宽度由fill-column变量决定。<br/>
</p></div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> <i>sudo::</i></h2>
<div class="outline-text-2" id="text-13">

<p>  如果你用普通用户权限打开emacs，则此时打开超级用户权限的文件是无法修改的，以超级用户重新打开一个emacs可行但考虑到emacs的启动速度，这绝对不是个好主意。<br/>
  解决办法：C-x C-f <i>sudo::</i> Enter 之后输入密码即可以超级用户权限打开一个文件。<br/>
</p></div>

</div>

<div id="outline-container-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> 正则表达式</h2>
<div class="outline-text-2" id="text-14">

<p>  Emacs中正则表达式要注意group和重复所用的括号需要转义， <code>\(\)</code> , <code>\{3,6\}</code><br/>
  语法类包括：<br/>
</p>


<pre class="example">[:digit:]  a digit, same as [0-9]
[:upper:]  a letter in uppercase
[:space:]  a whitespace character, as defined by the syntax table
[:xdigit:] an hexadecimal digit
[:cntrl:]  a control character
[:ascii:]  an ascii character
\s-   whitespace character        \s/   character quote character
\sw   word constituent            \s$   paired delimiter         
\s_   symbol constituent          \s'   expression prefix        
\s.   punctuation character       \s&lt;   comment starter          
\s(   open delimiter character    \s&gt;   comment ender            
\s)   close delimiter character   \s!   generic comment delimiter
\s"   string quote character      \s|   generic string delimiter 
\s\   escape character            
</pre>

<p>
  用re-builder查询时要又重转义即转义字符要转义，即上面的要写成\\(\\), \\{3,6\\}，即要匹配一个字面上的\需要4个\，即\\<br/>
  re-builder中[:digit:]在写成[和]要写2次.<br/>
</p>


<pre class="example">"\\(\\+\\|-\\)?[0-9]+\\(\\.[0-9]+\\)?"        表示一个数
"[[:digit:]]\\{3\\}"                          表示连续3个数字
</pre>


</div>

</div>

<div id="outline-container-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> eshell 别名/使用.bashrc中定义的别名</h2>
<div class="outline-text-2" id="text-15">

<p>  Eshell中 find-file filename即可打开文件，等价于C-x C-f filename<br/>
  可以定义别名 alias emacs 'find-file $1'，这样在eshell中emacs filename即可打开文件<br/>
</p>
<p>
  我在.bashrc中定义了许多别名，eshell的别名默认保存在 <code>~/.eshell/alias</code> 中，由变量 <code>eshell-aliases-file</code> 确定，为在方便备份我把它必为 <code>~/.emacs.d/eshell/alias</code> ，为了使eshell可以使用这些别名，可以使用下面的命令把所有在shell中可用的别名加到eshell中。<br/>
</p>


<pre class="example">cd ~/.emacs.d/eshell &amp;&amp; cat alias &gt; tmp &amp;&amp; echo -e "\n" &gt;&gt; tmp &amp;&amp; alias | sed -E "s/^alias ([^=]+)='(.*)'$/alias \1 \2/g; s/'\\\''/'/g;" &gt;&gt; tmp &amp;&amp; sort -u tmp &gt; alias &amp;&amp; rm -f tmp &amp;&amp; sed -i -e '/clc/d' -e '/^$/d'  alias &amp;&amp; cd - &gt;/dev/null
</pre>

<p>
  一个很简单的正则替换，其中最后删掉clc行是因为我在shell下用clc充当clear的别名，而此命令在eshell下无效且影响我定义的另一个名为clc的eshell下的孙：<br/>
</p>


<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">clc &#28165;&#23631;,&#22312;eshell&#20013;&#36755;&#20837;&#21629;&#20196;&#32780;&#38750;M-x clc</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">eshell/clc</span>()
  <span style="color: #8b2252;">"to clear the eshell buffer."</span>
  (interactive)
  (<span style="color: #a020f0;">let</span> ((inhibit-read-only t))
    (erase-buffer)))
</pre>


<p>  <br/>
</p></div>

</div>

<div id="outline-container-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> 解决org-mode example/src/quote上面多一行问题</h2>
<div class="outline-text-2" id="text-16">

<p>  不知道是不是org-mode的bug？如下所示的代码<br/>
</p>


<pre class="example">|  abc
|  cef
|  #+begin_example
|  hello
|  #+end_example  
</pre>

<p>
  经编译后生成：<br/>
</p>


<pre class="example">&lt;p&gt;  abc&lt;br/&gt;
  cef&lt;br/&gt;
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;
&lt;pre class="example"&gt;hello
&lt;/pre&gt;
&lt;/p&gt;
</pre>

<p>
  但浏览器解析是这样解析的：<br/>
</p>


<pre class="example">&lt;p&gt;  abc&lt;br/&gt;
  cef&lt;br/&gt;
&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class="example"&gt;hello
&lt;/pre&gt;
</pre>

<p>
  这样就会在cef和hello之间多出一行。<br/>
  分析lisp/org-html.el代码发现原因在:<br/>
</p>


<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Check if the line break needs to be conserved</span>
(<span style="color: #a020f0;">cond</span>
 ((string-match <span style="color: #8b2252;">"\\\\\\\\[ \t]*$"</span> line)
  (setq line (replace-match <span style="color: #8b2252;">"&lt;br/&gt;"</span> t t line)))
 (org-export-preserve-breaks
  (setq line (concat line <span style="color: #8b2252;">"&lt;br/&gt;"</span>))
  ))
</pre>

<p>
  不管line是否为空都会给line后面加上&lt;br/&gt;，而实际上当Line为空时没有必要加上&lt;br/&gt;，于是可以修改:<br/>
</p>


<pre class="src src-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Check if the line break needs to be conserved</span>
(<span style="color: #a020f0;">cond</span>
 ((string-match <span style="color: #8b2252;">"\\\\\\\\[ \t]*$"</span> line)
  (setq line (replace-match <span style="color: #8b2252;">"&lt;br/&gt;"</span> t t line)))
 (org-export-preserve-breaks
  (<span style="color: #a020f0;">if</span> (not (string= line <span style="color: #8b2252;">""</span>))
      (setq line (concat line <span style="color: #8b2252;">"&lt;br/&gt;"</span>)))
  ))
</pre>

<p>
  这样便解决了多一行的问题。<br/>
</p></div>

</div>

<div id="outline-container-17" class="outline-2">
<h2 id="sec-17"><span class="section-number-2">17</span> 分享/评论</h2>
<div class="outline-text-2" id="text-17">


<a class="bshareDiv" href="http://www.bshare.cn/share">分享按钮</a><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#uuid=&amp;style=10&amp;bgcolor=Blue"></script>
<br/>
<script src="../../Layout/JS/disqus-comment.js"></script>
<div id="disqus_thread">
</div>

</div>
</div>
</div>

</body>
</html>
